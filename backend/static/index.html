<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ä°nsan Ekspertizi</title>
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/png" href="/static/logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Raleway:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #0f172a; --accent: #d4af37; --text: #f8fafc; --card-bg: rgba(255,255,255,0.05); }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background: linear-gradient(135deg, #000 0%, #1e293b 100%); color: var(--text); font-family: 'Raleway', sans-serif; min-height: 100vh; padding-bottom: 70px; }
        
        .header { padding: 20px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
        h1 { font-family: 'Cinzel', serif; font-size: 22px; color: var(--accent); }
        
        /* FORM MODAL (AÃ§Ä±lÄ±r Pencere) */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 1000; justify-content: center; align-items: center; padding: 20px;
        }
        .modal-content {
            background: #1e293b; padding: 25px; border-radius: 15px; border: 1px solid var(--accent);
            width: 100%; max-width: 400px; text-align: center;
        }
        .close-btn { float: right; font-size: 24px; cursor: pointer; color: #aaa; }
        input { width: 100%; padding: 12px; margin: 10px 0; background: #333; border: 1px solid #555; color: white; border-radius: 5px; }
        .action-btn { background: var(--accent); color: black; border: none; padding: 12px 25px; font-weight: bold; cursor: pointer; border-radius: 5px; width: 100%; margin-top: 10px; }
        
        /* SONUÃ‡ EKRANI */
        #sonuc-kutusu { 
            margin-top: 20px; text-align: left; background: rgba(0,0,0,0.3); padding: 15px; 
            border-radius: 10px; font-size: 14px; line-height: 1.6; max-height: 300px; overflow-y: auto; display: none;
        }

        /* GRID MENÃœ */
        .dashboard-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 20px; }
        .menu-item {
            background: var(--card-bg); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 15px; padding: 20px; text-align: center; cursor: pointer;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .icon { font-size: 30px; margin-bottom: 10px; }
        .label { font-size: 13px; font-weight: bold; letter-spacing: 1px; }

        /* YÃœKLENÄ°YOR */
        .loader { border: 4px solid #333; border-top: 4px solid var(--accent); border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 20px auto; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="header">
        <h1>Ä°NSAN EKSPERTÄ°ZÄ°</h1>
        <p style="font-size: 12px; opacity: 0.7;">Platform</p>
    </div>

    <div class="dashboard-grid">
        <div class="menu-item" onclick="window.location.href='/static/ebced_form.html'">
            <span class="icon">ğŸ§®</span>
            <span class="label">EBCED HESABI</span>
        </div>

        <div class="menu-item" onclick="modalAc('isimModal')">
            <span class="icon">ğŸ“œ</span>
            <span class="label">Ä°SÄ°M ANALÄ°ZÄ°</span>
        </div>

        <div id="ruya-analizi-container" class="analysis-section">
    <h3>ğŸŒ™ RÃœYA TABÄ°RLERÄ° VE BÄ°LÄ°NÃ‡ALTI ANALÄ°ZÄ°</h3>
    <p>RÃ¼yanÄ± anlat, kadim semboller ve yapay zeka ile ÅŸifresini Ã§Ã¶zelim.</p>
    
    <textarea id="ruyaMetni" rows="5" placeholder="Ã–rn: RÃ¼yamda kaza yapmÄ±ÅŸ bir araba gÃ¶rdÃ¼m ve yerden altÄ±n topluyordum..." style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc;"></textarea>
    
    <button onclick="ruyaAnaliziYap()" style="margin-top: 10px; padding: 10px 20px; background-color: #4a00e0; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">
        ğŸ”® RÃœYAMI YORUMLA
    </button>

    <div id="ruyaSonuc" style="margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-left: 5px solid #4a00e0; display: none; white-space: pre-wrap;">
        </div>
</div>

<script>
async function ruyaAnaliziYap() {
    const metin = document.getElementById("ruyaMetni").value;
    const sonucKutusu = document.getElementById("ruyaSonuc");
    
    if (metin.length < 5) {
        alert("LÃ¼tfen rÃ¼yanÄ±zÄ± detaylÄ± anlatÄ±n.");
        return;
    }

    // YÃ¼kleniyor efekti
    sonucKutusu.style.display = "block";
    sonucKutusu.innerHTML = "â³ Kadim arÅŸivler taranÄ±yor, bilinÃ§altÄ±na iniliyor...";

    const formData = new FormData();
    formData.append("ruya_metni", metin);

    try {
        const response = await fetch("/api/ruya-analizi", {
            method: "POST",
            body: formData
        });

        const data = await response.json();
        
        if (data.analiz) {
            // Gelen metni gÃ¼zelce formatla
            sonucKutusu.innerHTML = data.analiz;
        } else {
            sonucKutusu.innerHTML = "âŒ Bir hata oluÅŸtu: " + (data.hata || "Bilinmeyen hata");
        }
    } catch (error) {
        sonucKutusu.innerHTML = "âŒ BaÄŸlantÄ± hatasÄ±! Sunucu Ã§alÄ±ÅŸÄ±yor mu?";
        console.error("Hata:", error);
    }
}
</script>
        <div class="menu-item" onclick="alert('YakÄ±nda...')"><span class="icon">ğŸª</span><span class="label">ASTROLOJÄ°</span></div>
    </div>

    <div id="isimModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="modalKapat('isimModal')">&times;</span>
            <h2 style="color:var(--accent); margin-bottom:15px;">Ä°sim Analizi</h2>
            <p style="font-size:12px; margin-bottom:15px;">Ã–zel kÃ¼tÃ¼phanemizden isminizin gizemini Ã§Ã¶zÃ¼yoruz.</p>
            
            <input type="text" id="analizIsim" placeholder="AdÄ±nÄ±z">
            <input type="text" id="analizSoyisim" placeholder="SoyadÄ±nÄ±z">
            
            <button class="action-btn" onclick="isimAnaliziYap()">ANALÄ°Z ET</button>
            
            <div class="loader" id="loader"></div>
            <div id="sonuc-kutusu"></div>
        </div>
    </div>

    <script>
        // Modal AÃ§/Kapat
        function modalAc(id) { document.getElementById(id).style.display = 'flex'; }
        function modalKapat(id) { document.getElementById(id).style.display = 'none'; }

        // --- Ä°SÄ°M ANALÄ°ZÄ° FONKSÄ°YONU ---
        async function isimAnaliziYap() {
            const isim = document.getElementById('analizIsim').value;
            const soyisim = document.getElementById('analizSoyisim').value;
            const loader = document.getElementById('loader');
            const sonucKutusu = document.getElementById('sonuc-kutusu');

            if(!isim || !soyisim) { alert("LÃ¼tfen isim ve soyisim giriniz."); return; }

            // YÃ¼kleniyor...
            loader.style.display = 'block';
            sonucKutusu.style.display = 'none';
            sonucKutusu.innerHTML = "";

            // Backend'e Veri GÃ¶nder (Form Data olarak)
            const formData = new FormData();
            formData.append('isim', isim);
            formData.append('soyisim', soyisim);

            try {
                const response = await fetch('/api/isim-analizi-yap', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                
                loader.style.display = 'none';
                sonucKutusu.style.display = 'block';

                if (response.ok) {
                    // Yapay Zekadan gelen cevabÄ± yazdÄ±r
                    // YÄ±ldÄ±z (*) iÅŸaretlerini kalÄ±n yapmak iÃ§in basit formatlama
                    let temizMetin = data.analiz_sonucu.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                    temizMetin = temizMetin.replace(/\n/g, '<br>');
                    
                    sonucKutusu.innerHTML = `
                        <h3 style="color:#d4af37; margin-bottom:10px;">${data.kisi}</h3>
                        ${temizMetin}
                        <br><br><small style="color:#666">Kaynak: ${data.kaynak}</small>
                    `;
                } else {
                    sonucKutusu.innerHTML = `<span style="color:red">Hata: ${data.hata || 'Sunucu hatasÄ±'}</span>`;
                }

            } catch (error) {
                loader.style.display = 'none';
                sonucKutusu.style.display = 'block';
                sonucKutusu.innerHTML = `<span style="color:red">BaÄŸlantÄ± HatasÄ±: ${error}</span>`;
            }
        }
    </script>
</body>
</html>