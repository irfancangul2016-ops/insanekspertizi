<!DOCTYPE html>
<html lang="tr">
<head>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ä°nsan Ekspertizi | Premium Analiz</title>
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/9626/9626780.png">
    <meta name="theme-color" content="#6c5ce7">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* KOMUT PALETÄ° STÄ°LLERÄ° */
        .cmd-item {
            padding: 12px 15px;
            display: flex; align-items: center;
            color: #b2bec3;
            cursor: pointer;
            border-radius: 8px;
            transition: 0.1s;
        }
        .cmd-item:hover {
            background: rgba(108, 92, 231, 0.2);
            color: white;
        }
        .cmd-item i { width: 25px; color: #a29bfe; }
        .cmd-key {
            margin-left: auto;
            background: rgba(255,255,255,0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            min-width: 20px;
            text-align: center;
        }
        @keyframes spin { 100% { -webkit-transform: rotate(360deg); transform:rotate(360deg); } }
        /* --- KOZMÄ°K PREMIUM TEMA --- */
        :root { 
            --primary: #6c5ce7; 
            --accent: #a29bfe;
            --dark-bg: #0f0c29; 
            --card-bg: rgba(255, 255, 255, 0.05); /* YarÄ± saydam */
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-main: #ffffff;
            --text-muted: #b2bec3;
            --radius: 24px; 
            --transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        body { 
            font-family: 'Poppins', sans-serif; 
            /* Derin Mor Uzay GradyanÄ± */
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            background-attachment: fixed; /* Arkaplan sabit kalsÄ±n */
            margin: 0; 
            color: var(--text-main); 
            overflow-x: hidden; 
            line-height: 1.6; 
            min-height: 100vh;
        }

        /* Scrollbar GÃ¼zelleÅŸtirme */
        ::-webkit-scrollbar { width: 10px; } 
        ::-webkit-scrollbar-track { background: #0f0c29; }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 5px; }

        /* NAV (Cam Efekti) */
        nav { 
            background: rgba(15, 12, 41, 0.7); 
            backdrop-filter: blur(20px); 
            -webkit-backdrop-filter: blur(20px);
            padding: 1.2rem 5%; 
            display: flex; justify-content: space-between; align-items: center; 
            position: sticky; top: 0; z-index: 1000; 
            border-bottom: 1px solid var(--glass-border); 
        }
        
        .nav-link { text-decoration: none; color: var(--text-muted); font-weight: 500; transition: 0.3s; }
        .nav-link:hover { color: var(--accent); text-shadow: 0 0 10px var(--primary); }

        /* BUTONLAR (Neon Efekti) */
        .btn-base { padding: 10px 25px; border-radius: 50px; font-weight: 600; cursor: pointer; border: none; font-size: 0.95rem; transition: var(--transition); letter-spacing: 0.5px; }
        .btn-outline { border: 1px solid var(--primary); color: var(--accent); background: transparent; }
        .btn-outline:hover { background: var(--primary); color: white; box-shadow: 0 0 15px var(--primary); }
        
        .btn-fill { 
            background: linear-gradient(45deg, var(--primary), #8e44ad); 
            color: white; 
            box-shadow: 0 4px 15px rgba(108, 92, 231, 0.4);
        } 
        .btn-fill:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(108, 92, 231, 0.6); }

        /* HERO ALANI */
        .hero { text-align: center; padding: 100px 20px 60px; position: relative; }
        .hero h1 { 
            font-size: 3.5rem; 
            margin-bottom: 20px; 
            line-height: 1.2; 
            font-weight: 700; 
            
            /* Gradyan Metin AyarlarÄ± */
            background: linear-gradient(to right, #fff, #a29bfe); 
            -webkit-background-clip: text; /* Chrome, Safari iÃ§in */
            background-clip: text;         /* Standart Ã¶zellik (Hata Ã§Ã¶zen kÄ±sÄ±m) */
            -webkit-text-fill-color: transparent; 
        }
        .hero p { font-size: 1.1rem; color: var(--text-muted); max-width: 600px; margin: 0 auto 30px; }

        /* KARTLAR (Glassmorphism) */
        .tools-grid { max-width: 1100px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(360px, 1fr)); gap: 40px; padding: 20px; }
        
        .tool-card { 
            background: var(--card-bg); 
            backdrop-filter: blur(15px);
            padding: 40px; 
            border-radius: var(--radius); 
            border: 1px solid var(--glass-border); 
            transition: var(--transition); 
            position: relative; overflow: hidden;
        }
        .tool-card:hover { 
            transform: translateY(-10px); 
            border-color: var(--primary); 
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); 
            background: rgba(255,255,255,0.08);
        }
        .tool-card h3 { color: white; margin-top: 0; font-size: 1.5rem; display: flex; align-items: center; gap: 10px; }
        .tool-card h3 i { color: var(--accent); }

        /* MENTOR SEÃ‡Ä°MÄ° */
        .m-option { 
            flex: 1; padding: 15px; 
            border: 1px solid var(--glass-border); 
            border-radius: 16px; 
            cursor: pointer; text-align: center; transition: 0.3s; 
            background: rgba(0,0,0,0.2); color: var(--text-muted);
        }
        .m-option:hover { background: rgba(255,255,255,0.1); color: white; }
        .m-option.selected { 
            border-color: var(--primary); 
            background: rgba(108, 92, 231, 0.2); 
            color: var(--accent); 
            box-shadow: 0 0 15px rgba(108, 92, 231, 0.2);
        }

        /* INPUTLAR */
        input[type="text"], input[type="email"], input[type="password"], textarea { 
            width: 100%; padding: 16px; 
            background: rgba(0,0,0,0.3); 
            border: 1px solid var(--glass-border); 
            border-radius: 12px; 
            margin-bottom: 15px; 
            color: white; font-family: inherit; box-sizing: border-box; transition: 0.3s; 
        }
        input:focus, textarea:focus { outline: none; border-color: var(--primary); background: rgba(0,0,0,0.5); }
        
        .submit-btn { width: 100%; padding: 18px; background: white; color: var(--dark-bg); border: none; border-radius: 12px; font-weight: 800; cursor: pointer; font-size: 1rem; transition: 0.3s; }
        .submit-btn:hover { background: var(--accent); box-shadow: 0 0 20px rgba(255,255,255,0.4); }

        /* MODALS */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(8px); z-index: 2000; justify-content: center; align-items: center; }
        .modal-box { 
            background: #1e1b4b; /* Koyu Modal */
            width: 90%; max-width: 500px; padding: 40px; border-radius: 24px; position: relative; 
            border: 1px solid var(--glass-border);
            color: white;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .close-modal { position: absolute; top: 20px; right: 25px; cursor: pointer; font-size: 1.5rem; color: var(--text-muted); transition: 0.3s; }
        .close-modal:hover { color: white; transform: rotate(90deg); }

        /* GEÃ‡MÄ°Åž LÄ°STESÄ° */
        .history-list { max-height: 400px; overflow-y: auto; text-align: left; }
        .h-item { padding: 15px; border-bottom: 1px solid var(--glass-border); display: flex; justify-content: space-between; align-items: center; transition:0.2s; }
        .h-item:hover { background: rgba(255,255,255,0.05); }
        .h-status { font-size: 0.75rem; font-weight: bold; padding: 5px 10px; border-radius: 6px; }
        .status-ready { background: rgba(46, 204, 113, 0.2); color: #2ecc71; border: 1px solid rgba(46, 204, 113, 0.3); }
        .h-btn { padding: 8px 16px; border-radius: 8px; border: none; cursor: pointer; font-size: 0.85rem; margin-left: 10px; background: var(--primary); color: white; }

        /* DAKTÄ°LO ALANI */
        .typewriter-text { 
            text-align: left; white-space: pre-wrap; line-height: 1.8; font-size: 1rem; 
            color: #dfe6e9; 
            background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px; border: 1px solid var(--glass-border);
            max-height: 60vh; overflow-y: auto; 
        }

        @media (max-width: 768px) { .nav-actions { display: none; } .nav-center { display:none; } .hero h1 { font-size: 2.2rem; } }
        /* --- RENK DÃœZELTME YAMASI --- */
        
        /* 1. InputlarÄ±n iÃ§ini zorla koyu yap, yazÄ±yÄ± beyaz yap */
        input, textarea, select {
            background-color: rgba(0, 0, 0, 0.4) !important; 
            color: #ffffff !important;
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
        }
        /* TarayÄ±cÄ± otomatik doldurma yapÄ±nca arka planÄ± sarÄ±/beyaz yapmasÄ±n */
        input:-webkit-autofill,
        input:-webkit-autofill:hover, 
        input:-webkit-autofill:focus {
            -webkit-text-fill-color: #ffffff;
            -webkit-box-shadow: 0 0 0px 1000px #24243e inset;
            transition: background-color 5000s ease-in-out 0s;
        }

        /* 2. ModallarÄ±n (GiriÅŸ/SonuÃ§ EkranÄ±) arka planÄ±nÄ± netleÅŸtir */
        .modal-box {
            background-color: #1e1b4b !important; /* Ã‡ok koyu lacivert */
            color: #ffffff !important;
            border: 1px solid #6c5ce7;
        }
        
        /* 3. Mentor seÃ§im kutularÄ±ndaki yazÄ±lar okunmuyorsa */
        .m-option {
            background-color: rgba(255, 255, 255, 0.05);
            color: #b2bec3;
        }
        .m-option.selected {
            background-color: rgba(108, 92, 231, 0.3);
            color: #ffffff;
            font-weight: bold;
        }
        /* --- ACÄ°L DÃœZELTME YAMASI (EN ALTA EKLE) --- */

        /* 1. MODAL KUTULARINI TAMAMEN KOYU YAP */
        .modal-box, #resultModal .modal-box, #historyModal .modal-box {
            background-color: #1e1b4b !important; /* Koyu Lacivert */
            background: #1e1b4b !important;       /* Gradyan varsa ez */
            color: #ffffff !important;            /* YazÄ±lar Beyaz */
            border: 1px solid #6c5ce7 !important; /* Ã‡erÃ§eve Mor */
            box-shadow: 0 0 40px rgba(0,0,0,0.7) !important;
        }

        /* 2. MODAL BAÅžLIKLARINI DÃœZELT */
        .modal-box h2, .modal-box h3, #resultTitle {
            color: #a29bfe !important; /* BaÅŸlÄ±klar AÃ§Ä±k Mor */
            background: transparent !important; /* ArkasÄ± beyaz kalmasÄ±n */
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 15px;
        }

        /* 3. KURTARICI Ã‡ARPI (X) BUTONU */
        .close-modal {
            position: absolute !important;
            top: 15px !important;
            right: 15px !important;
            
            /* GÃ¶rÃ¼nÃ¼rlÃ¼k AyarlarÄ± */
            background-color: #ff4757 !important; /* KIRMIZI */
            color: #ffffff !important;            /* BEYAZ X */
            
            width: 36px !important;
            height: 36px !important;
            border-radius: 50% !important;
            display: flex !important;
            align-items: center;
            justify-content: center;
            font-size: 20px !important;
            z-index: 9999 !important; /* En Ã¼stte dur */
            cursor: pointer !important;
            opacity: 1 !important; /* ÅžeffaflÄ±ÄŸÄ± kaldÄ±r */
            box-shadow: 0 0 10px rgba(255, 71, 87, 0.6) !important;
        }
        .close-modal:hover {
            background-color: #ff6b81 !important;
            transform: rotate(90deg);
        }

        /* 4. INPUT ALANLARINI BELÄ°RGÄ°NLEÅžTÄ°R */
        input, textarea, select {
            background-color: rgba(255, 255, 255, 0.07) !important; /* Hafif ÅŸeffaf */
            color: #ffffff !important;
            border: 1px solid rgba(162, 155, 254, 0.3) !important; /* Ä°nce mor Ã§erÃ§eve */
        }
        input:focus, textarea:focus {
            background-color: rgba(255, 255, 255, 0.1) !important;
            border-color: #6c5ce7 !important;
            box-shadow: 0 0 15px rgba(108, 92, 231, 0.2) !important;
        }

        /* 5. SEÃ‡Ä°M RENGÄ°NÄ° DÃœZELT (O Mavi ArkaplanÄ± KaldÄ±r) */
        ::selection {
            background: #6c5ce7;
            color: white;
        }
        /* --- MÄ°LYAR DOLARLIK UX GÃœNCELLEMESÄ° --- */

        /* 1. Z-INDEX HÄ°YERARÅžÄ°SÄ° (Vercel StandardÄ±) */
        :root {
            --z-base: 0;
            --z-dropdown: 100;
            --z-modal: 1000;
            --z-toast: 2000;
            --z-tooltip: 3000;
            /* Framer Motion benzeri yaylanma efekti */
            --spring-easing: cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        }

        /* 2. BUTON MÄ°KRO-ETKÄ°LEÅžÄ°MLERÄ° (Physics-Based) */
        .btn-base, .tool-card, .h-item, .m-option {
            transition: transform 0.2s var(--spring-easing), box-shadow 0.2s ease, background-color 0.2s ease !important;
        }
        /* TÄ±klama anÄ±nda iÃ§eri gÃ¶Ã§me (Tactile Feel) */
        .btn-base:active, .tool-card:active, .h-item:active {
            transform: scale(0.96) translateY(2px) !important;
        }
        /* Hover durumunda hafif yÃ¼kselme */
        .btn-base:hover, .tool-card:hover {
            transform: scale(1.02) translateY(-2px);
            box-shadow: 0 10px 20px rgba(108, 92, 231, 0.3);
        }

        /* 3. SKELETON LOADING (Ä°skelet YÃ¼kleme) */
        .skeleton {
            background: linear-gradient(90deg, rgba(255,255,255,0.05) 25%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite linear;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

        .sk-item { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); display:flex; justify-content:space-between; align-items:center; }
        .sk-text-line { height: 12px; width: 60%; margin-bottom: 8px; }
        .sk-text-short { height: 10px; width: 30%; }
        .sk-btn { height: 30px; width: 80px; border-radius: 50px; }

        /* 4. AKILLI BOÅž DURUM (Smart Empty State) */
        .empty-state {
            text-align: center; padding: 40px 20px;
            animation: popIn 0.4s var(--spring-easing);
        }
        .empty-icon {
            font-size: 4rem; color: rgba(255,255,255,0.1); margin-bottom: 20px;
            display: inline-block;
            transform: rotate(-10deg);
        }
        .empty-cta { margin-top: 20px; }
        /* Ä°ÅžLEM MODALI ANÄ°MASYONLARI */
        @keyframes pulse {
            0% { transform: scale(1); text-shadow: 0 0 0px rgba(162, 155, 254, 0); }
            50% { transform: scale(1.1); text-shadow: 0 0 20px rgba(162, 155, 254, 0.5); }
            100% { transform: scale(1); text-shadow: 0 0 0px rgba(162, 155, 254, 0); }
        }
        /* --- MÃœHENDÄ°SLÄ°K STANDARTLARI (PERFORMANS & HÄ°YERARÅžÄ°) --- */

        :root {
            /* Vercel StandardÄ± Katmanlama */
            --z-negative: -1;
            --z-base: 0;
            --z-nav: 100;      /* MenÃ¼ */
            --z-dropdown: 200; 
            --z-modal: 1000;   /* Pencereler */
            --z-overlay: 999;  /* Karartma perdesi */
            --z-toast: 2000;   /* Bildirimler */
            --z-max: 9999;     /* Ã‡arpÄ± butonu, Mouse imleci vb. */
        }

        /* 1. GLASSMORPHISM PERFORMANS OPTÄ°MÄ°ZASYONU */
        /* 'contain: paint' komutu tarayÄ±cÄ±ya "Sadece bu kutunun iÃ§ini bulanÄ±klaÅŸtÄ±r, tÃ¼m sayfayÄ± yorma" der */
        .tool-card, .modal-box, nav, .post-card {
            backdrop-filter: blur(20px) !important;
            -webkit-backdrop-filter: blur(20px) !important;
            contain: paint; /* GPU'yu rahatlatÄ±r */
        }

        /* 2. Z-INDEX DÃœZELTMELERÄ° (Rastgele sayÄ±lar yerine deÄŸiÅŸkenler) */
        nav { 
            z-index: var(--z-nav) !important; 
        }
        
        .modal-overlay, #processingModal { 
            z-index: var(--z-modal) !important; 
        }

        /* Ã‡arpÄ± butonu her zaman modalÄ±n Ã¼stÃ¼nde olmalÄ± */
        .close-modal { 
            z-index: var(--z-max) !important; 
        }

        /* Bildirim balonlarÄ± en Ã¼stte */
        #successModal {
            z-index: var(--z-toast) !important;
        }
        /* PROFÄ°L VE ROZET SÄ°STEMÄ° */
        .profile-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(162, 155, 254, 0.3);
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        /* Parlayan Rozet Efekti */
        .badge {
            display: inline-flex; align-items: center; gap: 8px;
            background: linear-gradient(90deg, #fd79a8, #e84393);
            color: white;
            padding: 8px 16px;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(232, 67, 147, 0.4);
            margin-bottom: 15px;
            animation: float 3s ease-in-out infinite;
        }
        
        .stat-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;
        }
        .stat-box {
            background: rgba(0,0,0,0.2); padding: 15px; border-radius: 12px;
        }
        .stat-num { font-size: 1.5rem; font-weight: bold; color: #a29bfe; }
        .stat-label { font-size: 0.75rem; color: #b2bec3; }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0px); }
        }
        /* --- PROFÄ°L VE OYUNLAÅžTIRMA STÄ°LLERÄ° --- */
        .profile-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(162, 155, 254, 0.3);
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        /* Parlayan Rozet Efekti */
        .badge {
            display: inline-flex; align-items: center; gap: 8px;
            background: linear-gradient(90deg, #fd79a8, #e84393);
            color: white;
            padding: 8px 16px;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(232, 67, 147, 0.4);
            margin-bottom: 15px;
            animation: float 3s ease-in-out infinite;
        }
        
        /* Ä°statistik KutularÄ± */
        .stat-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;
        }
        .stat-box {
            background: rgba(0,0,0,0.2); padding: 15px; border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.05);
            transition: 0.2s;
        }
        .stat-box:hover { background: rgba(0,0,0,0.4); transform: translateY(-2px); }
        .stat-num { font-size: 1.5rem; font-weight: bold; color: #a29bfe; }
        .stat-label { font-size: 0.75rem; color: #b2bec3; }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0px); }
        }
        
    </style>
</head>
<body>
    <audio id="bgMusic" loop>
    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
    </audio>

    <div id="commandPalette" class="modal-overlay" style="align-items:flex-start; padding-top:100px;">
        <div class="modal-box" style="width:600px; max-width:90%; padding:0; overflow:hidden; border:1px solid #6c5ce7; box-shadow:0 0 50px rgba(108, 92, 231, 0.4);">
            <div style="padding:15px; border-bottom:1px solid rgba(255,255,255,0.1); display:flex; align-items:center;">
                <i class="fa-solid fa-magnifying-glass" style="color:#a29bfe; margin-right:10px;"></i>
                <input type="text" placeholder="Ne yapmak istiyorsun? (Ã–rn: RÃ¼ya, Ä°sim, GeÃ§miÅŸ...)" 
                       style="border:none !important; background:transparent !important; box-shadow:none !important; padding:0; font-size:1.1rem; height:auto;"
                       id="cmdInput">
                <span style="background:rgba(255,255,255,0.1); padding:2px 6px; border-radius:4px; font-size:0.7rem; color:#b2bec3;">ESC</span>
            </div>
            
            <div style="padding:10px;" id="cmdList">
                <div class="cmd-item" onclick="closeModal('commandPalette'); document.getElementById('ruya-tab').click(); document.getElementById('ruya-metni').focus();">
                    <i class="fa-solid fa-moon"></i> <span>RÃ¼ya Yorumla</span> <span class="cmd-key">R</span>
                </div>
                <div class="cmd-item" onclick="closeModal('commandPalette'); document.getElementById('isim-tab').click(); document.getElementById('isim').focus();">
                    <i class="fa-solid fa-fingerprint"></i> <span>Ä°sim Analizi Yap</span> <span class="cmd-key">Ä°</span>
                </div>
                <div class="cmd-item" onclick="closeModal('commandPalette'); openHistory();">
                    <i class="fa-solid fa-clock-rotate-left"></i> <span>GeÃ§miÅŸ Analizlerim</span> <span class="cmd-key">G</span>
                </div>
                <div class="cmd-item" onclick="closeModal('commandPalette'); window.location.href='/blog';">
                    <i class="fa-solid fa-feather"></i> <span>Blog YazÄ±larÄ±nÄ± Oku</span> <span class="cmd-key">B</span>
                </div>
            </div>
        </div>
    </div>

    <div id="musicControl" onclick="toggleMusic()" style="position:fixed; bottom:20px; right:20px; z-index:1000; background:rgba(255,255,255,0.1); backdrop-filter:blur(5px); padding:10px; border-radius:50%; cursor:pointer; border:1px solid rgba(255,255,255,0.2); transition:0.3s;">
        <i id="musicIcon" class="fa-solid fa-volume-xmark" style="color:white; font-size:1.2rem; width:20px; text-align:center;"></i>
    </div>
    <nav>
        <a href="/" class="logo">
            <i class="fa-solid fa-moon" style="font-size:1.8rem; color:#a29bfe;"></i> 
            <span style="background: linear-gradient(to right, #fff, #a29bfe); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">Ä°nsan Ekspertizi</span>
        </a>
        
        <div class="nav-center">
            <a href="/blog" class="nav-link"><i class="fa-solid fa-feather"></i> Blog & Makaleler</a>
        </div>

        <div class="nav-actions" id="guest-nav">
            <button class="btn-base btn-outline" onclick="openModal('loginModal')">GiriÅŸ</button>
            <button class="btn-base btn-fill" onclick="openModal('registerModal')">KayÄ±t Ol</button>
        </div>
        <div class="nav-actions" id="user-nav" style="display: none;">
            <button class="btn-base btn-outline" onclick="openHistory()"><i class="fa-solid fa-clock-rotate-left"></i> Analizlerim</button>
            <button class="btn-base btn-fill" onclick="logout()">Ã‡Ä±kÄ±ÅŸ</button>
        </div>
    </nav>

    <div id="main-content">
        <section id="guest-hero" class="hero">
            <h1>GerÃ§ek Uzmanlardan <br> <span>Profesyonel Analiz</span></h1>
            <p>SeÃ§tiÄŸiniz uzman (Yahya Bey, AslÄ± HanÄ±m veya Dr. Mustafa) verilerinizi inceler ve size Ã¶zel raporu 10 dakika iÃ§inde hazÄ±rlar.</p>
            
            <div style="display:flex; gap:10px; justify-content:center; margin-top:30px;">
                <button class="submit-btn" onclick="openModal('registerModal')" style="width:auto; padding: 15px 40px;">
                    Hemen BaÅŸla
                </button>
                <a href="/blog" class="submit-btn" style="width:auto; padding: 15px 40px; background:rgb(76, 0, 255); color:var(--dark); border:1px solid #ddd; text-decoration:none;">
                    Blog'a GÃ¶z At
                </a>
            </div>
        </section>

        <section id="member-tools" class="tools-grid" style="display: none;">
            
            <div class="tool-card">
                <h3><i class="fa-solid fa-fingerprint"></i> Ä°sim Karakter Analizi</h3>
                <p style="font-size:0.9rem; color:#666; margin-bottom:20px;">Kimin analiz etmesini istersiniz?</p>
                
                <div class="mentor-select-wrapper">
                    <div class="mentor-options" id="isim-mentor-select">
                        <div class="m-option selected" onclick="selectOption(this, 'isim_mentor', 'yahya')">
                            <i class="fa-solid fa-book-quran"></i> Yahya Bey
                        </div>
                        <div class="m-option" onclick="selectOption(this, 'isim_mentor', 'asli')">
                            <i class="fa-solid fa-star"></i> AslÄ± HanÄ±m
                        </div>
                        <div class="m-option" onclick="selectOption(this, 'isim_mentor', 'mustafa')">
                            <i class="fa-solid fa-brain"></i> Dr. Mustafa
                        </div>
                    </div>
                    <input type="hidden" id="isim_mentor" value="yahya">
                </div>
                <input type="text" id="honey_trap" name="website_url" tabindex="-1" autocomplete="off" 
                        style="opacity: 0; position: absolute; top: 0; left: 0; height: 0; width: 0; z-index: -1;">
                <input type="text" id="isim" placeholder="AdÄ±nÄ±z">
                <input type="text" id="soyisim" placeholder="SoyadÄ±nÄ±z" autocomplete="off" name="user_surname_field">
                <button class="submit-btn" onclick="submitRequest('isim')">
                    <i class="fa-solid fa-paper-plane"></i> Ä°ncelemeye GÃ¶nder
                </button>
            </div>

            <div class="tool-card">
                <h3><i class="fa-solid fa-moon"></i> RÃ¼ya Yorumu</h3>
                <p style="font-size:0.9rem; color:#666; margin-bottom:20px;">Kimin yorumlamasÄ±nÄ± istersiniz?</p>
                
                <div class="mentor-select-wrapper">
                    <div class="mentor-options" id="ruya-mentor-select">
                        <div class="m-option selected" onclick="selectOption(this, 'ruya_mentor', 'yahya')">
                            <i class="fa-solid fa-book-quran"></i> Yahya Bey
                        </div>
                        <div class="m-option" onclick="selectOption(this, 'ruya_mentor', 'asli')">
                            <i class="fa-solid fa-star"></i> AslÄ± HanÄ±m
                        </div>
                        <div class="m-option" onclick="selectOption(this, 'ruya_mentor', 'mustafa')">
                            <i class="fa-solid fa-brain"></i> Dr. Mustafa
                        </div>
                    </div>
                    <input type="hidden" id="ruya_mentor" value="yahya">
                </div>

                <textarea id="ruya-metni" rows="4" placeholder="RÃ¼yanÄ±zÄ± detaylÄ± anlatÄ±n..."></textarea>
                <button class="submit-btn" onclick="submitRequest('ruya')">
                    <i class="fa-solid fa-paper-plane"></i> Ä°ncelemeye GÃ¶nder
                </button>
            </div>
        </section>
    </div>

    <div id="successModal" class="modal-overlay">
        <div class="modal-box">
            <div style="font-size:4rem; color:#00b894; margin-bottom:20px;"><i class="fa-regular fa-circle-check"></i></div>
            <h2>Talep Ä°letildi!</h2>
            <p id="successMsg" style="color:#666; margin-bottom:20px;"></p>
            <p style="font-size:0.9rem; background:#fc0000; padding:10px; border-radius:10px;">
                <i class="fa-solid fa-bell"></i> Analiz tamamlandÄ±ÄŸÄ±nda "Analizlerim" kÄ±smÄ±ndan gÃ¶rÃ¼ntÃ¼leyebilirsiniz.
            </p>
            <button class="submit-btn" onclick="closeModal('successModal')" style="margin-top:20px;">Tamam</button>
        </div>
    </div>

    <div id="resultModal" class="modal-overlay">
        <div class="modal-box" style="max-width:700px; text-align:left;">
            <span class="close-modal" onclick="closeModal('resultModal')">&times;</span>
            <h3 id="resultTitle" style="color:var(--primary); margin-top:0;">Analiz Raporu</h3>
            <hr style="border:0; border-top:1px solid #eee; margin:15px 0;">
            
            <div id="typewriterArea" class="typewriter-text"></div>
            <div style="margin-top:20px; text-align:right; display:flex; justify-content:flex-end; gap:10px;">
                <button id="storyBtn" class="btn-base btn-outline" onclick="downloadStory()" style="border-color:#e1306c; color:#e1306c;">
                <i class="fa-brands fa-instagram"></i> Story PaylaÅŸ
            </button>
    <button class="btn-base btn-outline" onclick="downloadPDF()"><i class="fa-solid fa-file-pdf"></i> PDF Ä°ndir</button>
    <button class="btn-base btn-outline" onclick="copyResult()"><i class="fa-regular fa-copy"></i> Kopyala</button>
    </div>
        </div>
    </div>

    <div id="historyModal" class="modal-overlay">
        <div class="modal-box" style="max-width:600px; padding:0; overflow:hidden;">
            <div style="padding:20px; background:#1900ff; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
                <h3 style="margin:0;">Analizlerim</h3>
                <span style="cursor:pointer; font-size:1.5rem;" onclick="closeModal('historyModal')">&times;</span>
            </div>
            <div id="historyList" class="history-list"></div>
        </div>
    </div>

    <div id="loginModal" class="modal-overlay">
        <div class="modal-box">
            <h2>GiriÅŸ Yap</h2>
            <input type="email" id="loginEmail" class="auth-input" placeholder="E-posta">
            <input type="password" id="loginPass" class="auth-input" placeholder="Åžifre">
            <button class="submit-btn" onclick="login()">GiriÅŸ Yap</button>
        </div>
    </div>

    <div id="registerModal" class="modal-overlay">
        <div class="modal-box">
            <h2>KayÄ±t Ol</h2>
            <input type="email" id="regEmail" class="auth-input" placeholder="E-posta">
            <input type="password" id="regPass" class="auth-input" placeholder="Åžifre">
            <button class="submit-btn" onclick="register()">KayÄ±t Ol</button>
        </div>
    </div>

    <script>
        // --- GLOBAL DEÄžÄ°ÅžKENLER (Veri YÃ¶netimi Ä°Ã§in) ---
        let currentUserAnalyses = []; // Analizleri burada tutacaÄŸÄ±z
        let typeInterval; // Daktilo efekti iÃ§in
        // --- MÃœZÄ°K KONTROLÃœ ---
        let musicPlaying = false;
        
        document.addEventListener('DOMContentLoaded', () => {
            const music = document.getElementById('bgMusic');
            music.volume = 0.005; // SES SEVÄ°YESÄ° (%20) - RahatsÄ±z etmesin diye kÄ±sÄ±k
            
            // KullanÄ±cÄ± sayfada herhangi bir yere tÄ±kladÄ±ÄŸÄ±nda mÃ¼ziÄŸi baÅŸlat
            document.body.addEventListener('click', function startMusic() {
                if (!musicPlaying) {
                    music.play().then(() => {
                        musicPlaying = true;
                        updateMusicIcon();
                    }).catch(e => console.log("MÃ¼zik baÅŸlatÄ±lamadÄ± (HenÃ¼z etkileÅŸim yok)"));
                    
                    // Olay dinleyiciyi kaldÄ±r (Tek seferlik Ã§alÄ±ÅŸsÄ±n)
                    document.body.removeEventListener('click', startMusic);
                }
            });
            // --- KLAVYE KISAYOLLARI (Command Palette & Navigasyon) ---
        document.addEventListener('keydown', (e) => {
            
            // 1. ESC: TÃ¼m modallarÄ± kapat
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal-overlay').forEach(m => m.style.display = 'none');
            }

            // 2. CMD+K veya CTRL+K: Komut Paletini AÃ§
            if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                e.preventDefault(); // TarayÄ±cÄ±nÄ±n arama Ã§ubuÄŸunu engelle
                openModal('commandPalette');
                document.getElementById('cmdInput').focus();
            }

            // 3. "/" TUÅžU: Arama veya Inputa Odaklan (EÄŸer yazÄ± yazmÄ±yorsak)
            if (e.key === '/' && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA') {
                e.preventDefault();
                // O an hangi sekme aÃ§Ä±ksa onun inputuna git
                let visibleInput = document.getElementById('ruya-metni').offsetParent ? 'ruya-metni' : 'isim';
                document.getElementById(visibleInput).focus();
            }
        });

        // --- SEKME GEÃ‡Ä°ÅžLERÄ° Ä°Ã‡Ä°N UFAK BÄ°R DÃœZELTME ---
        // (EÄŸer sekme deÄŸiÅŸtirme kodun yoksa veya butonlara ID vermediysen, 
        // HTML'deki butonlarÄ±na id="isim-tab" ve id="ruya-tab" eklemeyi unutma)
        });

        function toggleMusic() {
            const music = document.getElementById('bgMusic');
            if (music.paused) {
                music.play();
                musicPlaying = true;
            } else {
                music.pause();
                musicPlaying = false;
            }
            updateMusicIcon();
        }

        function updateMusicIcon() {
            const icon = document.getElementById('musicIcon');
            const music = document.getElementById('bgMusic');
            if (!music.paused) {
                icon.className = "fa-solid fa-music";
                icon.style.color = "#a29bfe"; // Ã‡alarken mor olsun
                // DÃ¶ner animasyon ekleyelim
                icon.style.animation = "spin 4s linear infinite";
            } else {
                icon.className = "fa-solid fa-volume-xmark";
                icon.style.color = "white";
                icon.style.animation = "none";
            }
        }
        // --- SEÃ‡Ä°M MANTIÄžI ---
        function selectOption(el, inputId, value) {
            const container = el.parentElement;
            container.querySelectorAll('.m-option').forEach(opt => opt.classList.remove('selected'));
            el.classList.add('selected');
            document.getElementById(inputId).value = value;
        }

        // --- PDF Ä°NDÄ°RME FONKSÄ°YONU (YENÄ°) ---
        // --- YENÄ° VE GERÃ‡EK PDF Ä°NDÄ°RME FONKSÄ°YONU ---
        function downloadPDF() {
            // Ä°ndirilecek alanÄ± seÃ§
            const element = document.getElementById('typewriterArea');
            
            // PDF AyarlarÄ±
            const opt = {
                margin:       20,
                filename:     'Insan_Ekspertizi_Analiz_Raporu.pdf',
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2 }, // YÃ¼ksek Ã§Ã¶zÃ¼nÃ¼rlÃ¼k iÃ§in
                jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            // PDF oluÅŸtur ve indir (YazdÄ±rma ekranÄ± aÃ§maz)
            html2pdf().set(opt).from(element).save();
        }
        // --- INSTAGRAM STORY Ä°NDÄ°RME ---
        function downloadStory() {
            // 1. Analiz metnini al
            let fullText = document.getElementById('typewriterArea').innerText;
            
            // 2. Metni kÄ±salt (Story'e sÄ±ÄŸmasÄ± iÃ§in ilk 350 karakter)
            // EÄŸer metin Ã§ok uzunsa sonuna "..." koyarÄ±z
            let shortText = fullText.length > 350 ? fullText.substring(0, 350) + "..." : fullText;

            // 3. Åžablona yerleÅŸtir
            document.getElementById('storyText').innerText = '"' + shortText + '"';

            // 4. KullanÄ±cÄ±ya bilgi ver
            let originalBtnText = document.getElementById('storyBtn').innerHTML;
            document.getElementById('storyBtn').innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> HazÄ±rlanÄ±yor...';

            // 5. Resmi OluÅŸtur ve Ä°ndir
            const template = document.getElementById('storyTemplate');
            
            html2canvas(template, {scale: 1}).then(canvas => {
                let link = document.createElement('a');
                link.download = 'Insan_Ekspertizi_Story.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                // Butonu dÃ¼zelt
                document.getElementById('storyBtn').innerHTML = originalBtnText;
            });
        }

        // --- Ä°STEK GÃ–NDERME ---
        // --- Ä°YÄ°MSER UI SÄ°MÃœLASYONLU Ä°STEK FONKSÄ°YONU ---
        async function submitRequest(type) {
            const token = localStorage.getItem("token");
            if(!token) return openModal('loginModal');

            // --- BAL KÃœPÃœ KONTROLÃœ (BOT TUZAÄžI) ---
            const trap = document.getElementById('honey_trap');
            if (trap && trap.value !== "") {
                console.log("Bot tespit edildi! ðŸ¤–");
                return; // Sessizce iÅŸlemi durdur, botu uyarmana gerek yok.
            }
            

            // 1. VERÄ°LERÄ° AL
            let fd = new FormData();
            let url = "";
            let simulationMessages = [];

            if(type === 'isim') {
                const isim = document.getElementById('isim').value;
                const soyisim = document.getElementById('soyisim').value;
                const mentor = document.getElementById('isim_mentor').value;
                if(!isim) { alert("Ä°sim giriniz"); return; }
                fd.append("isim", isim);
                fd.append("soyisim", soyisim);
                fd.append("mentor", mentor);
                url = "/api/isim-analizi-yap";
                
                // Ä°sim Analizi iÃ§in Ã–zel Mesajlar
                simulationMessages = [
                    "Ä°sim harfleri analiz ediliyor...",
                    "Ebced deÄŸerleri hesaplanÄ±yor...",
                    "Karakteristik Ã¶zellikler taranÄ±yor...",
                    "Rapor hazÄ±rlanÄ±yor..."
                ];
            } else {
                const ruya = document.getElementById('ruya-metni').value;
                const mentor = document.getElementById('ruya_mentor').value;
                if(!ruya) { alert("RÃ¼ya giriniz"); return; }
                fd.append("ruya_metni", ruya);
                fd.append("mentor", mentor);
                url = "/api/ruya-analizi";

                // RÃ¼ya Analizi iÃ§in Ã–zel Mesajlar
                simulationMessages = [
                    "RÃ¼ya metni yapay zekaya iletiliyor...",
                    "BilinÃ§altÄ± sembolleri ayrÄ±ÅŸtÄ±rÄ±lÄ±yor...",
                    "Ä°slami kaynaklar taranÄ±yor...",
                    "RÃ¼ya tabiri oluÅŸturuluyor..."
                ];
            }

            // 2. Ä°ÅžLEM MODALINI AÃ‡ VE SÄ°MÃœLASYONU BAÅžLAT
            openModal('processingModal');
            let progress = 0;
            const bar = document.getElementById('progressBar');
            const percentTxt = document.getElementById('progressPercent');
            const statusTxt = document.getElementById('processText');
            
            // SimÃ¼lasyon ZamanlayÄ±cÄ±sÄ± (GerÃ§ek API yanÄ±t verene kadar dÃ¶ner)
            let simInterval = setInterval(() => {
                // %90'a kadar yavaÅŸÃ§a ilerle, orada bekle
                if(progress < 90) {
                    progress += Math.random() * 5; // Rastgele artÄ±ÅŸ
                    if(progress > 90) progress = 90;
                    
                    bar.style.width = progress + "%";
                    percentTxt.innerText = Math.floor(progress) + "%";
                    
                    // MesajlarÄ± ilerlemeye gÃ¶re deÄŸiÅŸtir
                    let msgIndex = Math.floor((progress / 100) * simulationMessages.length);
                    if(simulationMessages[msgIndex]) {
                        statusTxt.innerText = simulationMessages[msgIndex];
                    }
                }
            }, 500); // YarÄ±m saniyede bir gÃ¼ncelle

            try {
                // 3. GERÃ‡EK Ä°STEÄžÄ° GÃ–NDER (Arka planda)
                let res = await fetch(url, {method:"POST", headers:{"Authorization":`Bearer ${token}`}, body:fd});
                
                // 4. Ä°ÅžLEM BÄ°TTÄ°, SÄ°MÃœLASYONU TAMAMLA
                clearInterval(simInterval);
                bar.style.width = "100%";
                percentTxt.innerText = "100%";
                statusTxt.innerText = "Ä°ÅŸlem TamamlandÄ±!";

                // KÄ±sa bir bekleme (kullanÄ±cÄ± %100'Ã¼ gÃ¶rsÃ¼n)
                setTimeout(async () => {
                    closeModal('processingModal'); // YÃ¼kleme ekranÄ±nÄ± kapat

                    if(res.ok) {
                        // BaÅŸarÄ±lÄ±!
                        document.getElementById("successMsg").innerText = "Analiziniz baÅŸarÄ±yla tamamlandÄ±!";
                        openModal('successModal');
                        fireConfetti();
                        // InputlarÄ± temizle
                        if(document.getElementById('isim')) document.getElementById('isim').value = "";
                        if(document.getElementById('ruya-metni')) document.getElementById('ruya-metni').value = "";
                    } else {
                        // Hata
                        alert("Bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.");
                    }
                }, 800);

            } catch(e) {
                clearInterval(simInterval);
                closeModal('processingModal');
                alert("BaÄŸlantÄ± hatasÄ±.");
            }
        }

        // --- GEÃ‡MÄ°Åž VE DURUM KONTROLÃœ (DÃœZELTÄ°LDÄ°) ---
        // --- GÃœNCELLENMÄ°Åž PREMIUM GEÃ‡MÄ°Åž FONKSÄ°YONU ---
        async function openHistory() {
            openModal('historyModal');
            const list = document.getElementById('historyList');
            
            // YÃ¼kleniyor Ä°skeleti
            list.innerHTML = `<div class="skeleton" style="height:150px; margin-bottom:20px;"></div>` + 
                            `<div class="sk-item"><div class="skeleton sk-text-line"></div></div>`.repeat(3);
            
            try {
                const token = localStorage.getItem("token");
                if(!token) {
                    list.innerHTML = renderEmptyState("GiriÅŸ YapmalÄ±sÄ±nÄ±z", "Profilinizi gÃ¶rmek iÃ§in giriÅŸ yapÄ±n.", "GiriÅŸ Yap", "openModal('loginModal')");
                    return;
                }

                const res = await fetch("/api/users/me", {headers:{"Authorization":`Bearer ${token}`}});
                if(!res.ok) throw new Error("Hata");

                const user = await res.json();
                currentUserAnalyses = user.analyses || [];
                const userEmail = user.email.split('@')[0]; 

                // --- OYUNLAÅžTIRMA: PROFÄ°L KARTI OLUÅžTUR ---
                let count = currentUserAnalyses.length;
                let unvan = "MeraklÄ± Ruh";
                let rozet = "Yeni Ãœye";
                let rozetIcon = "fa-user";
                let rozetColor = "linear-gradient(90deg, #b2bec3, #636e72)"; 

                if(count >= 1) { unvan = "Analist Ã‡Ä±raÄŸÄ±"; rozet="Erken EriÅŸim"; rozetColor="linear-gradient(90deg, #fd79a8, #e84393)"; rozetIcon="fa-star"; }
                if(count >= 5) { unvan = "RÃ¼ya Gezgini"; rozet="SadÄ±k Ãœye"; rozetColor="linear-gradient(90deg, #0984e3, #74b9ff)"; rozetIcon="fa-shield-halved"; }
                if(count >= 10) { unvan = "BilinÃ§altÄ± ÃœstadÄ±"; rozet="Efsane"; rozetColor="linear-gradient(90deg, #f1c40f, #f39c12)"; rozetIcon="fa-crown"; }
                
                let profileHTML = `
                    <div class="profile-card">
                        <div class="badge" style="background:${rozetColor}"><i class="fa-solid ${rozetIcon}"></i> ${rozet}</div>
                        <h2 style="color:white; margin:0; text-transform:capitalize;">${userEmail}</h2>
                        <div style="color:#a29bfe; font-size:0.9rem; margin-top:5px;">${unvan}</div>
                        
                        <div class="stat-grid">
                            <div class="stat-box">
                                <div class="stat-num">${count}</div>
                                <div class="stat-label">Toplam Analiz</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-num">Aktif</div>
                                <div class="stat-label">Hesap Durumu</div>
                            </div>
                        </div>
                    </div>
                    <h4 style="color:#dfe6e9; margin-bottom:15px; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:10px;">Son Ä°ÅŸlemler</h4>
                `;

                // --- LÄ°STELEME ---
                if(count === 0) {
                    // Analiz yoksa: Profil + Ã–rnek GÃ¶sterim
                    list.innerHTML = profileHTML + `
                        <div class="empty-state" style="animation: popIn 0.5s var(--spring-easing);">
                            <div class="empty-icon"><i class="fa-solid fa-wand-magic-sparkles" style="color:#a29bfe;"></i></div>
                            <h3 style="color:white; margin-bottom:5px;">HenÃ¼z Analiz Yok</h3>
                            <p style="color:#b2bec3; font-size:0.9rem; margin-bottom:20px;">Ä°lk analizinizi yapÄ±n, sonuÃ§larÄ±nÄ±z bÃ¶yle gÃ¶rÃ¼nsÃ¼n:</p>
                            
                            <div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:12px; text-align:left; margin-bottom:20px; border:1px dashed #6c5ce7; position:relative; overflow:hidden;">
                                <div style="position:absolute; top:10px; right:10px; background:#6c5ce7; color:white; font-size:0.6rem; padding:2px 8px; border-radius:4px;">Ã–RNEK</div>
                                <div style="font-weight:bold; color:#a29bfe; font-size:0.9rem; margin-bottom:5px;"><i class="fa-solid fa-fingerprint"></i> Ä°sim Analizi</div>
                                <div style="color:#dfe6e9; font-size:0.8rem; line-height:1.4;">
                                    "Ä°sminizdeki 'A' harfi liderlik vasfÄ±nÄ±, 'K' harfi ise gÃ¼Ã§lÃ¼ sezgileri temsil ediyor..."
                                </div>
                                <div style="margin-top:10px; height:6px; background:rgba(255,255,255,0.1); border-radius:4px; width:80%;"></div>
                                <div style="margin-top:5px; height:6px; background:rgba(255,255,255,0.1); border-radius:4px; width:60%;"></div>
                            </div>

                            <button class="btn-base btn-fill" onclick="closeModal('historyModal')">Kendi Analizini GÃ¶r</button>
                        </div>
                    `;
                } else {
                    // Analiz varsa: Ã–nce Profil HTML'i ekle, sonra listeyi dÃ¶ngÃ¼ye sok
                    list.innerHTML = profileHTML; // <--- DÃœZELTME BURADA YAPILDI
                    
                    currentUserAnalyses.forEach((a, index) => {
                        let tarihStr = "Tarih Yok";
                        if(a.created_at) {
                            let rawDate = a.created_at.endsWith("Z") ? a.created_at : a.created_at + "Z";
                            tarihStr = new Date(rawDate).toLocaleString('tr-TR', {
                                day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit'
                            });
                        }

                        let iconHtml = a.analysis_type === 'ISIM' 
                            ? '<i class="fa-solid fa-fingerprint" style="color:#a29bfe"></i> Ä°sim Analizi' 
                            : '<i class="fa-solid fa-moon" style="color:#a29bfe"></i> RÃ¼ya Yorumu';

                        list.innerHTML += `
                            <div class="h-item" onclick="openResultByIndex(${index})" style="cursor:pointer;">
                                <div class="h-info">
                                    <div style="font-weight:bold; color:white;">${iconHtml}</div>
                                    <div style="font-size:0.8rem; color:#b2bec3; margin-top:4px;">${a.input_text.substring(0,25)}...</div>
                                    <div style="font-size:0.7rem; color:#636e72; margin-top:2px;">${tarihStr}</div>
                                </div>
                                <div style="text-align:right;">
                                    <span class="h-status status-ready" style="margin-right:10px;"><i class="fa-solid fa-check"></i> HazÄ±r</span>
                                    <button class="h-btn btn-view">Sonucu Oku</button>
                                </div>
                            </div>
                        `;
                    });
                }

            } catch(e) {
                console.log(e);
                list.innerHTML = renderEmptyState("Hata", "Profil yÃ¼klenemedi.", "Yenile", "openHistory()");
            }
        }   

        // --- YARDIMCI FONKSÄ°YON: BOÅž DURUM TASARIMI (YENÄ°) ---
        // Bunu openHistory fonksiyonunun altÄ±na ekle
        function renderEmptyState(title, desc, btnText, btnAction) {
            return `
                <div class="empty-state">
                    <div class="empty-icon"><i class="fa-solid fa-scroll"></i></div>
                    <h3 style="color:#a29bfe; margin-bottom:10px;">${title}</h3>
                    <p style="color:#b2bec3; font-size:0.9rem; margin-bottom:20px;">${desc}</p>
                    <button class="btn-base btn-outline" onclick="${btnAction}">${btnText}</button>
                </div>
            `;
        }

        // --- YENÄ° SONUÃ‡ GÃ–STERME FONKSÄ°YONU ---
        function openResultByIndex(index) {
            const analiz = currentUserAnalyses[index];
            if(!analiz) return;

            closeModal('historyModal');
            openModal('resultModal');

            document.getElementById('resultTitle').innerText = 
                analiz.analysis_type === 'ISIM' ? 'Ä°sim Karakter Analizi' : 'RÃ¼ya Tabiri Raporu';
            
            const text = analiz.result_text;
            const container = document.getElementById('typewriterArea');
            container.innerHTML = ""; 
            
            let i = 0;
            clearInterval(typeInterval);

            // HÄ±zlÄ± Daktilo Efekti
            typeInterval = setInterval(() => {
                container.innerHTML += text.charAt(i);
                container.scrollTop = container.scrollHeight;
                i++;
                if (i >= text.length) clearInterval(typeInterval);
            }, 10);
        }

        function copyResult() {
            const text = document.getElementById('typewriterArea').innerText;
            navigator.clipboard.writeText(text);
            alert("KopyalandÄ±!");
        }

        // --- AUTH & GENEL ---
        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; clearInterval(typeInterval); }
        
        if(localStorage.getItem("token")) {
            document.getElementById("guest-nav").style.display = "none";
            document.getElementById("user-nav").style.display = "flex";
            document.getElementById("guest-hero").style.display = "none";
            document.getElementById("member-tools").style.display = "grid";
        }

        async function login() {
            const email = document.getElementById("loginEmail").value;
            const pass = document.getElementById("loginPass").value;
            let fd = new FormData(); fd.append("username", email); fd.append("password", pass);
            
            try {
                let res = await fetch("/api/token", {method:"POST", body:fd});
                if(res.ok) {
                    let data = await res.json();
                    localStorage.setItem("token", data.access_token);
                    window.location.reload();
                } else {
                    let errorData = await res.json();
                    alert("GiriÅŸ YapÄ±lamadÄ±: " + (errorData.detail || "Hata"));
                }
            } catch(e) { alert("BaÄŸlantÄ± hatasÄ±."); }
        }

        async function register() {
            let email = document.getElementById("regEmail").value;
            let pass = document.getElementById("regPass").value;
            try {
                let res = await fetch("/api/register", {
                    method:"POST", 
                    headers:{"Content-Type":"application/json"}, 
                    body:JSON.stringify({email, password:pass})
                });
                if(res.ok) { 
                    alert("KayÄ±t BaÅŸarÄ±lÄ±! GiriÅŸ yapabilirsiniz."); 
                    closeModal('registerModal');
                    openModal('loginModal');
                } else {
                    let errorData = await res.json();
                    alert("KayÄ±t BaÅŸarÄ±sÄ±z: " + (errorData.detail || "Hata"));
                }
            } catch(e) { alert("BaÄŸlantÄ± hatasÄ±."); }
        }

        function logout() { localStorage.removeItem("token"); window.location.reload(); }
        // --- KUTLAMA EFEKTÄ° (CONFETTI) ---
        function fireConfetti() {
            var duration = 3 * 1000;
            var animationEnd = Date.now() + duration;
            var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 99999 };

            function randomInRange(min, max) { return Math.random() * (max - min) + min; }

            var interval = setInterval(function() {
                var timeLeft = animationEnd - Date.now();

                if (timeLeft <= 0) { return clearInterval(interval); }

                var particleCount = 50 * (timeLeft / duration);
                
                // EkranÄ±n solundan ve saÄŸÄ±ndan rastgele fÄ±rlat
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
            }, 250);
        }
    </script>
    <div id="storyTemplate" style="
        position: fixed; left: -9999px; top: 0; 
        width: 1080px; height: 1920px; 
        background: linear-gradient(135deg, #0f0c29, #302b63, #24243e); 
        font-family: 'Poppins', sans-serif; color: white; 
        display: flex; flex-direction: column; align-items: center; justify-content: center; 
        padding: 100px; box-sizing: border-box; z-index: 99999;">
        
        <div style="font-size: 70px; font-weight: 800; color: #a29bfe; margin-bottom: 120px; display: flex; align-items: center; gap: 30px;">
            <i class="fa-solid fa-moon"></i> Ä°nsan Ekspertizi
        </div>

        <div style="
            background: rgba(255, 255, 255, 0.08); 
            backdrop-filter: blur(40px); 
            padding: 80px; 
            border-radius: 60px; 
            border: 4px solid rgba(162, 155, 254, 0.3); 
            width: 100%; 
            box-shadow: 0 40px 100px rgba(0,0,0,0.5);
            text-align: center;">
            
            <h2 style="font-size: 55px; color: #a29bfe; margin-bottom: 50px; border-bottom: 2px solid rgba(255,255,255,0.1); padding-bottom: 30px;">
                KiÅŸiye Ã–zel Ruhsal Analiz
            </h2>
            
            <p id="storyText" style="font-size: 45px; line-height: 1.6; color: #ffffff; font-weight: 500;">
                </p>
            
            <div style="margin-top: 50px; font-size: 35px; color: #b2bec3;">
                <i class="fa-solid fa-quote-right"></i>
            </div>
        </div>

        <div style="margin-top: auto; text-align: center;">
            <div style="font-size: 40px; color: #fff; font-weight: bold; margin-bottom: 20px;">Senin RÃ¼yalarÄ±n Ne SÃ¶ylÃ¼yor?</div>
            <div style="background: white; color: #0f0c29; padding: 15px 40px; border-radius: 50px; font-size: 35px; font-weight: 800; display: inline-block;">
                insanekspertizi.org
            </div>
        </div>
    </div>
    <div id="processingModal" class="modal-overlay" style="z-index: 9999;">
        <div class="modal-box" style="text-align:center; max-width:400px;">
            <div style="font-size: 3rem; color:#a29bfe; margin-bottom:20px; animation: pulse 1.5s infinite;">
                <i class="fa-solid fa-microchip"></i>
            </div>
            
            <h3 id="processTitle" style="margin-bottom:10px; color:white;">Analiz BaÅŸlatÄ±lÄ±yor...</h3>
            <p id="processText" style="color:#b2bec3; font-size:0.9rem; margin-bottom:20px;">Veriler gÃ¼venli sunucuya iletiliyor...</p>
            
            <div style="background:rgba(255,255,255,0.1); border-radius:10px; height:8px; width:100%; overflow:hidden; position:relative;">
                <div id="progressBar" style="width:0%; height:100%; background: linear-gradient(90deg, #6c5ce7, #a29bfe); transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);"></div>
            </div>
            
            <div style="margin-top:10px; font-size:0.8rem; color:#636e72; text-align:right;">
                <span id="progressPercent">0%</span>
            </div>
        </div>
    </div>
</body>
</html>