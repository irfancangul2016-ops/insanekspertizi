<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒ∞nsan Ekspertizi | Yapay Zeka Destekli Analiz</title>
    <style>
        :root {
            --primary: #4a00e0;
            --secondary: #8e2de2;
            --bg: #f5f7fa;
            --text: #333;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; color: var(--text); }
        
        /* √úST MEN√ú (NAVBAR) */
        nav { background: white; padding: 15px 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: bold; color: var(--primary); text-decoration: none; }
        .auth-buttons button { margin-left: 10px; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-login { background: transparent; border: 2px solid var(--primary) !important; color: var(--primary); }
        .btn-register { background: var(--primary); color: white; }
        .btn-logout { background: #ff4757; color: white; }
        
        /* KONTEYNER */
        .container { max-width: 800px; margin: 40px auto; padding: 20px; }
        
        /* KARTLAR */
        .card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-bottom: 30px; }
        h2 { color: var(--primary); margin-top: 0; }
        
        /* FORMLAR */
        input, textarea { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        button.action-btn { width: 100%; padding: 12px; background: linear-gradient(to right, var(--primary), var(--secondary)); color: white; border: none; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: 0.3s; }
        button.action-btn:hover { opacity: 0.9; transform: translateY(-2px); }

        /* SONU√á KUTULARI */
        .result-box { margin-top: 20px; padding: 15px; background: #eef2f5; border-left: 5px solid var(--primary); border-radius: 5px; white-space: pre-wrap; display: none; color: #1a1a1a; line-height: 1.6; }

        /* MODAL (Gƒ∞Rƒ∞≈û PENCERESƒ∞) */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 30px; border-radius: 10px; width: 350px; position: relative; }
        .close { position: absolute; top: 10px; right: 15px; cursor: pointer; font-size: 1.5rem; }
    </style>
</head>
<body>

    <nav>
        <a href="#" class="logo">üß¨ ƒ∞nsan Ekspertizi</a>
        <div class="auth-buttons" id="guest-menu">
            <button class="btn-login" onclick="openModal('loginModal')">Giri≈ü Yap</button>
            <button class="btn-register" onclick="openModal('registerModal')">Kayƒ±t Ol</button>
        </div>
        <div class="auth-buttons" id="user-menu" style="display: none;">
            <span id="user-email-display" style="margin-right: 10px; font-weight: bold;"></span>
            <button class="btn-logout" onclick="logout()">√áƒ±kƒ±≈ü</button>
        </div>
    </nav>

    <div class="container">
        
        <div class="card">
            <h2>üìú ƒ∞sim & Karakter Analizi</h2>
            <p>ƒ∞sminizin enerjisini ve gizli ≈üifrelerini √ß√∂z√ºn.</p>
            <input type="text" id="isim" placeholder="Adƒ±nƒ±z">
            <input type="text" id="soyisim" placeholder="Soyadƒ±nƒ±z">
            <button class="action-btn" onclick="isimAnaliziYap()">Analiz Et</button>
            <div id="isimSonuc" class="result-box"></div>
        </div>

        <div class="card">
            <h2>üåô R√ºya Tabirleri</h2>
            <p>R√ºyanƒ±zƒ± anlatƒ±n, bilin√ßaltƒ± mesajƒ±nƒ±zƒ± yapay zeka yorumlasƒ±n.</p>
            <textarea id="ruyaMetni" rows="4" placeholder="R√ºyamda u√ßuyordum ve..."></textarea>
            <button class="action-btn" onclick="ruyaAnaliziYap()">R√ºyayƒ± Yorumla</button>
            <div id="ruyaSonuc" class="result-box"></div>
        </div>

    </div>

    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('loginModal')">&times;</span>
            <h2>Giri≈ü Yap</h2>
            <input type="email" id="loginEmail" placeholder="E-posta">
            <input type="password" id="loginPass" placeholder="≈ûifre">
            <button class="action-btn" onclick="login()">Giri≈ü</button>
        </div>
    </div>

    <div id="registerModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('registerModal')">&times;</span>
            <h2>Kayƒ±t Ol</h2>
            <input type="email" id="regEmail" placeholder="E-posta">
            <input type="password" id="regPass" placeholder="≈ûifre">
            <button class="action-btn" onclick="register()">Kayƒ±t Ol</button>
        </div>
    </div>

    <script>
        // --- AUTH Y√ñNETƒ∞Mƒ∞ ---
        const BASE_URL = "/api"; 
        
        function checkAuth() {
            const token = localStorage.getItem("token");
            const email = localStorage.getItem("email");
            
            if (token && email) {
                document.getElementById("guest-menu").style.display = "none";
                document.getElementById("user-menu").style.display = "block";
                document.getElementById("user-email-display").innerText = "üë§ " + email;
            } else {
                document.getElementById("guest-menu").style.display = "block";
                document.getElementById("user-menu").style.display = "none";
            }
        }

        async function register() {
            const email = document.getElementById("regEmail").value;
            const password = document.getElementById("regPass").value;

            try {
                const res = await fetch(`${BASE_URL}/register`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, password })
                });
                
                if (res.ok) {
                    alert("Kayƒ±t ba≈üarƒ±lƒ±! ≈ûimdi giri≈ü yapabilirsiniz.");
                    closeModal("registerModal");
                    openModal("loginModal");
                } else {
                    const data = await res.json();
                    alert("Hata: " + data.detail);
                }
            } catch (e) { alert("Sunucu hatasƒ±!"); }
        }

        async function login() {
            const email = document.getElementById("loginEmail").value;
            const password = document.getElementById("loginPass").value;
            
            const formData = new URLSearchParams();
            formData.append("username", email);
            formData.append("password", password);

            try {
                const res = await fetch(`${BASE_URL}/token`, {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: formData
                });

                if (res.ok) {
                    const data = await res.json();
                    localStorage.setItem("token", data.access_token);
                    localStorage.setItem("email", email);
                    checkAuth();
                    closeModal("loginModal");
                } else {
                    alert("Giri≈ü ba≈üarƒ±sƒ±z! Bilgileri kontrol edin.");
                }
            } catch (e) { alert("Baƒülantƒ± hatasƒ±!"); }
        }

        function logout() {
            localStorage.removeItem("token");
            localStorage.removeItem("email");
            location.reload();
        }

        // --- ANALƒ∞Z FONKSƒ∞YONLARI ---
        async function isimAnaliziYap() {
            const isim = document.getElementById("isim").value;
            const soyisim = document.getElementById("soyisim").value;
            const sonucDiv = document.getElementById("isimSonuc");

            sonucDiv.style.display = "block";
            sonucDiv.innerText = "‚è≥ Analiz yapƒ±lƒ±yor, l√ºtfen bekleyin...";

            const formData = new FormData();
            formData.append("isim", isim);
            formData.append("soyisim", soyisim);

            try {
                const res = await fetch(`${BASE_URL}/isim-analizi-yap`, {
                    method: "POST",
                    body: formData
                });
                const data = await res.json();
                sonucDiv.innerHTML = data.analiz_sonucu || "Sonu√ß alƒ±namadƒ±.";
            } catch (e) { sonucDiv.innerText = "Hata olu≈ütu."; }
        }

        async function ruyaAnaliziYap() {
            const metin = document.getElementById("ruyaMetni").value;
            const sonucDiv = document.getElementById("ruyaSonuc");

            sonucDiv.style.display = "block";
            sonucDiv.innerText = "‚è≥ R√ºya yorumlanƒ±yor...";

            const formData = new FormData();
            formData.append("ruya_metni", metin);

            try {
                const res = await fetch(`${BASE_URL}/ruya-analizi`, {
                    method: "POST",
                    body: formData
                });
                const data = await res.json();
                sonucDiv.innerHTML = data.analiz || "Sonu√ß alƒ±namadƒ±.";
            } catch (e) { sonucDiv.innerText = "Hata olu≈ütu."; }
        }

        // --- MODAL ƒ∞≈ûLEMLERƒ∞ ---
        function openModal(id) { document.getElementById(id).style.display = "flex"; }
        function closeModal(id) { document.getElementById(id).style.display = "none"; }
        
        // Sayfa a√ßƒ±lƒ±nca oturumu kontrol et
        checkAuth();
    </script>
</body>
</html>